#!/bin/bash
#
# bash_prompt
# bash-specific prompting

# Helper definitions
PS_ARROW=">"
PS_WINDOW=""
# if [[ -n "$WINDOW" ]]; then
# 	PS_WINDOW="#$WINDOW:"
# fi

# Helper functions
function __vc_prompt () {
    has_cmd vcprompt || return
    if [[ -d '.svn' ]]; then
	vcprompt -f ' [%n:%r]'
    else
	vcprompt -f ' [%n:%b]'
    fi
}
function __pwd_with_tilde () {
	/usr/bin/sed -E "s|^$HOME|~|" <<<"$PWD"
}
function __pwd_with_tilde_abbr () {
	__pwd_with_tilde | /usr/bin/sed -E 's|^(.+)(.{27})$|...\2|'
}


# Set the prompt
PS_DIR='\w$(__vc_prompt)'
PS_ONE='$PS_ARROW'

# Set terminal titles 
function __term_func () {
	title "$is" "$USER@${HOSTNAME%.*}" "$(__pwd_with_tilde_abbr)"
}

# Adapt prompt to PWD length
function __prompt_func () {
	if [[ $(__pwd_with_tilde | wc -c) -gt '35' ]]; then
		PS1="$PS_DIR\n$PS_ONE "
	else
		PS1="$PS_DIR$PS_ONE "
	fi
}

PROMPT_COMMAND='__prompt_func; __term_func'
