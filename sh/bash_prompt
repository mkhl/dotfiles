#!/bin/bash
#
# bash_prompt
# bash-specific prompting

# Helper definitions
PS_ARROW=">"
PS_WINDOW=""
if [[ -n "$WINDOW" ]]; then
	PS_WINDOW="#$WINDOW:"
fi
PS_SHELL="$is"
if (($SHLVL > 1)); then
	PS_SHELL="[$PS_SHELL]"
fi

# Helper functions
function __vc_prompt () {
	has_cmd vcprompt || return
	if [[ -d '.svn' ]]; then
		vcprompt -f ' [%n:%r]'
	else
		vcprompt -f ' [%n:%b]'
	fi
}
function __pwd_with_tilde () {
	/usr/bin/sed -E "s|^$HOME|~|" <<<"$PWD"
}
function __pwd_with_tilde_abbr () {
	__pwd_with_tilde | /usr/bin/sed -E 's|^(.+)(.{27})$|...\2|'
}

# Set the prompt
PS_DIR='$(__pwd_with_tilde_abbr)$(__vc_prompt)'
PS_ONE='$PS_ARROW'
PS1="$PS_SHELL:$PS_DIR$PS_ONE "

# Set terminal titles
function __term_func () {
	title "$is" "$USER@${HOSTNAME%.*}" "$(__pwd_with_tilde_abbr)"
}

PROMPT_COMMAND='__term_func'
