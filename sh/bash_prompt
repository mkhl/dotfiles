#!/bin/bash
#
# bash_prompt
# bash-specific prompting

# Helper definitions
PS_ARROW=">"
PS_DIRTY="*"
PS_FAIL="!"
PS_WINDOW=""
# if [[ -n "$WINDOW" ]]; then
#     PS_WINDOW="#$WINDOW:"
# fi

# Helper functions
__parse_git_dirty () {
    local marker=$PS_DIRTY
    if [[ -n "$1" ]]; then
        marker="$1"
    fi
    git status 2> /dev/null | grep -c : | awk "{if (\$1 > 0) print \"$marker\"}"
}
__parse_svn_dirty () {
    if [[ -d '.svn' ]]; then
        local marker="$PS_DIRTY"
        if [[ -n "$1" ]]; then
            marker="$1"
        fi
        if svn status 2> /dev/null | egrep -q . ; then
            builtin echo -ne " (svn)$marker"
        fi
    fi
}
__pwd_with_tilde () {
    echo $PWD | sed -e "s:$HOME:~:"
}

# Set the prompt
PS1='\w$(__git_ps1)$(__parse_git_dirty)$(__parse_svn_dirty) $PS_ARROW '


# Set terminal titles 
__term_func () {
    title "$is" "$USER@${HOSTNAME%.*}" "$(__pwd_with_tilde)"
}
PROMPT_COMMAND='__term_func'
